<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="api-base" content="http://localhost:8000/api" />
    <title>Shared Resource Calendar</title>
    <link rel="stylesheet" href="static/output.css" />
    <script src="https://unpkg.com/htmx.org@1.9.10" integrity="sha384-gbnI6F+YVMz/KGm3jIt6fFixNUg8mqOOuicF/CvNC2DcJIOf5H5z5z7lFQke3rG0" crossorigin="anonymous"></script>
  </head>
  <body>
    <main class="mx-auto flex min-h-screen w-full max-w-6xl flex-col gap-6 px-6 py-12">
      <section class="space-y-10">
        <header class="flex flex-col gap-4 xl:flex-row xl:items-end xl:justify-between">
          <div class="space-y-2">
            <p class="text-xs font-semibold uppercase tracking-wide text-indigo-600">Team retreat schedule</p>
            <h1 id="resource-title" class="text-3xl font-semibold">Loading…</h1>
            <p class="text-sm text-slate-600">One shared house for everyone. Coordinate multi-day stays, approvals, and openings from a single view.</p>
            <p id="calendar-updated" class="text-xs text-slate-400">Checking availability…</p>
          </div>
          <div class="flex flex-wrap items-center gap-3">
            <div class="rounded-lg border border-slate-200 bg-white px-4 py-3 shadow-sm">
              <p class="text-xs font-medium uppercase tracking-wide text-slate-500">Next open date</p>
              <p id="calendar-next-open" class="text-sm font-semibold text-slate-700">—</p>
            </div>
            <a id="new-request-link" class="inline-flex items-center gap-2 rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-indigo-500" href="#">
              <span aria-hidden="true">+</span>
              New request
            </a>
          </div>
        </header>

        <section class="grid gap-6 xl:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]">
          <article class="space-y-6 rounded-xl border border-slate-200 bg-white p-6 shadow-sm">
            <header class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
              <div>
                <h2 class="text-xl font-semibold text-slate-900">Availability</h2>
                <p id="calendar-month-label" class="text-sm text-slate-500">—</p>
              </div>
              <div class="flex flex-wrap items-center gap-2">
                <button class="inline-flex items-center rounded-md border border-slate-200 px-3 py-1.5 text-sm font-medium text-slate-600 transition hover:border-indigo-300 hover:text-indigo-600" type="button" data-calendar-action="prev">&#8592; Prev</button>
                <button class="inline-flex items-center rounded-md border border-slate-200 px-3 py-1.5 text-sm font-medium text-slate-600 transition hover:border-indigo-300 hover:text-indigo-600" type="button" data-calendar-action="today">Today</button>
                <button class="inline-flex items-center rounded-md border border-slate-200 px-3 py-1.5 text-sm font-medium text-slate-600 transition hover:border-indigo-300 hover:text-indigo-600" type="button" data-calendar-action="next">Next &#8594;</button>
              </div>
            </header>

            <dl class="grid gap-4 sm:grid-cols-3" id="calendar-metrics">
              <div class="rounded-lg bg-slate-50 p-4">
                <dt class="text-xs font-medium uppercase tracking-wide text-slate-500">Reservations</dt>
                <dd id="metric-reservations" class="mt-1 text-2xl font-semibold text-slate-900">0</dd>
              </div>
              <div class="rounded-lg bg-slate-50 p-4">
                <dt class="text-xs font-medium uppercase tracking-wide text-slate-500">Pending approval</dt>
                <dd id="metric-pending" class="mt-1 text-2xl font-semibold text-amber-600">0</dd>
              </div>
              <div class="rounded-lg bg-slate-50 p-4">
                <dt class="text-xs font-medium uppercase tracking-wide text-slate-500">Remaining slots</dt>
                <dd id="metric-remaining" class="mt-1 text-2xl font-semibold text-emerald-600">0</dd>
              </div>
            </dl>

            <div class="flex flex-wrap items-center gap-4 text-xs text-slate-500">
              <span class="inline-flex items-center gap-2"><span class="h-2 w-2 rounded-full bg-emerald-500"></span>Available</span>
              <span class="inline-flex items-center gap-2"><span class="h-2 w-2 rounded-full bg-indigo-500"></span>Booked</span>
              <span class="inline-flex items-center gap-2"><span class="h-2 w-2 rounded-full bg-amber-500"></span>Awaiting approval</span>
              <span class="inline-flex items-center gap-2"><span class="h-2 w-2 rounded-full bg-rose-500"></span>Full or blocked</span>
            </div>

            <div id="calendar-grid" class="space-y-2">
              <p class="text-sm text-slate-500">Loading calendar…</p>
            </div>
          </article>

          <div class="space-y-6">
            <article class="rounded-xl border border-slate-200 bg-white p-6 shadow-sm">
              <header class="flex items-start justify-between">
                <div>
                  <h2 class="text-xl font-semibold text-slate-900">Day overview</h2>
                  <p class="text-sm text-slate-500">Select a day to inspect reservations and status.</p>
                </div>
              </header>
              <div id="day-overview" class="pt-4">
                <p class="rounded-lg border border-dashed border-slate-200 bg-slate-50 p-6 text-center text-sm text-slate-500">Select a day in the calendar to view reservations and approve requests.</p>
              </div>
            </article>

            <article class="rounded-xl border border-slate-200 bg-white p-6 shadow-sm">
              <header class="flex items-center justify-between">
                <h2 class="text-xl font-semibold text-slate-900">Pending approvals</h2>
                <span id="pending-count" class="rounded-full bg-amber-100 px-2 py-0.5 text-xs font-medium text-amber-700">0 open</span>
              </header>
              <div id="pending-approvals" class="pt-4">
                <p class="py-6 text-sm text-slate-500">Loading pending requests…</p>
              </div>
            </article>
          </div>
        </section>
      </section>
    </main>

    <script>
      const apiMeta = document.querySelector('meta[name="api-base"]');
      const apiBase = apiMeta ? apiMeta.content.replace(/\/$/, '') : '';
      const fallbackResponse = {
        resource: { id: 'alder-lake-house', name: 'alder-lake-house', displayName: 'Alder Lake House' },
        calendar: {
          monthLabel: 'October 2025',
          selectedIso: '2025-10-14',
          totalBookings: 9,
          pendingCount: 4,
          remainingSlots: 18,
          nextAvailableLabel: 'Tue, 22 Oct 2025',
          updatedLabel: 'Synced a few moments ago',
          weekdayLabels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
          weeks: [
            [
              { iso: '2025-10-07', dayLabel: '7', isCurrentMonth: true, bookings: [], pendingCount: 0, remainingSlots: 3 },
              { iso: '2025-10-08', dayLabel: '8', isCurrentMonth: true, bookings: [], pendingCount: 0, remainingSlots: 3 },
              { iso: '2025-10-09', dayLabel: '9', isCurrentMonth: true, bookings: [{ id: 201, customerName: 'Nguyen Family', windowLabel: 'Whole day stay', status: 'confirmed' }], pendingCount: 0, remainingSlots: 2 },
              { iso: '2025-10-10', dayLabel: '10', isCurrentMonth: true, bookings: [], pendingCount: 0, remainingSlots: 3 },
              { iso: '2025-10-11', dayLabel: '11', isCurrentMonth: true, bookings: [{ id: 202, customerName: 'Lopez Wedding', windowLabel: 'Weekend celebration', status: 'confirmed' }], pendingCount: 0, remainingSlots: 0, isFull: true },
              { iso: '2025-10-12', dayLabel: '12', isCurrentMonth: true, bookings: [{ id: 203, customerName: 'Maintenance Crew', windowLabel: 'Deep clean', status: 'confirmed' }], pendingCount: 0, remainingSlots: 0, isUnavailable: true },
              { iso: '2025-10-13', dayLabel: '13', isCurrentMonth: true, bookings: [], pendingCount: 0, remainingSlots: 3 }
            ],
            [
              { iso: '2025-10-14', dayLabel: '14', isCurrentMonth: true, isToday: true, bookings: [
                { id: 301, customerName: 'Harper Family', windowLabel: 'All-day stay', status: 'confirmed', partySize: 4, notes: 'Celebrating an anniversary.' },
                { id: 302, customerName: 'Jackson Friends', windowLabel: 'Full day stay', status: 'pending', partySize: 6, notes: 'Hoping for early check-in on Monday night.' }
              ], pendingCount: 1, remainingSlots: 1 },
              { iso: '2025-10-15', dayLabel: '15', isCurrentMonth: true, bookings: [], pendingCount: 0, remainingSlots: 3 },
              { iso: '2025-10-16', dayLabel: '16', isCurrentMonth: true, bookings: [{ id: 303, customerName: 'Clarkson Offsite', windowLabel: 'Whole day stay', status: 'confirmed' }], pendingCount: 0, remainingSlots: 2 },
              { iso: '2025-10-17', dayLabel: '17', isCurrentMonth: true, bookings: [], pendingCount: 0, remainingSlots: 3 },
              { iso: '2025-10-18', dayLabel: '18', isCurrentMonth: true, bookings: [{ id: 304, customerName: 'Ramirez Family', windowLabel: 'Weekend stay', status: 'confirmed' }], pendingCount: 0, remainingSlots: 2 },
              { iso: '2025-10-19', dayLabel: '19', isCurrentMonth: true, bookings: [], pendingCount: 0, remainingSlots: 3 },
              { iso: '2025-10-20', dayLabel: '20', isCurrentMonth: true, bookings: [{ id: 305, customerName: 'Sato Group', windowLabel: 'Team offsite', status: 'pending', partySize: 3 }], pendingCount: 1, remainingSlots: 2 }
            ],
            [
              { iso: '2025-10-21', dayLabel: '21', isCurrentMonth: true, bookings: [{ id: 401, customerName: 'Design Sprint Crew', windowLabel: 'Workshop day', status: 'pending', partySize: 5 }], pendingCount: 1, remainingSlots: 2 },
              { iso: '2025-10-22', dayLabel: '22', isCurrentMonth: true, bookings: [], pendingCount: 0, remainingSlots: 3 },
              { iso: '2025-10-23', dayLabel: '23', isCurrentMonth: true, bookings: [], pendingCount: 0, remainingSlots: 3 },
              { iso: '2025-10-24', dayLabel: '24', isCurrentMonth: true, bookings: [{ id: 402, customerName: 'Coleman Family', windowLabel: 'Weekend stay', status: 'confirmed' }], pendingCount: 0, remainingSlots: 2 },
              { iso: '2025-10-25', dayLabel: '25', isCurrentMonth: true, bookings: [{ id: 403, customerName: 'Waitlist Crew', windowLabel: 'Overflow request', status: 'pending', partySize: 2 }], pendingCount: 1, remainingSlots: 1 },
              { iso: '2025-10-26', dayLabel: '26', isCurrentMonth: true, bookings: [], pendingCount: 0, remainingSlots: 3 },
              { iso: '2025-10-27', dayLabel: '27', isCurrentMonth: true, bookings: [], pendingCount: 0, remainingSlots: 3 }
            ]
          ]
        },
        selectedDay: null,
        pendingRequests: [
          { id: 302, customerName: 'Jackson Friends', date: '2025-10-14', dateLabel: 'Tue, 14 Oct', windowLabel: 'Full day stay', partySize: 6, notes: 'Hoping for early check-in on Monday night.' },
          { id: 305, customerName: 'Sato Group', date: '2025-10-20', dateLabel: 'Mon, 20 Oct', windowLabel: 'Team offsite', partySize: 3, notes: 'Needs projector.' },
          { id: 401, customerName: 'Design Sprint Crew', date: '2025-10-21', dateLabel: 'Tue, 21 Oct', windowLabel: 'Workshop day', partySize: 5, notes: 'Need whiteboard and fast Wi-Fi.' },
          { id: 403, customerName: 'Waitlist Crew', date: '2025-10-25', dateLabel: 'Sat, 25 Oct', windowLabel: 'Overflow request', partySize: 2, notes: 'Flexible on arrival time.' }
        ]
      };
      const fallbackDayDetails = {};
      const dateFormatter = new Intl.DateTimeFormat('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
      fallbackResponse.calendar.weeks.flat().forEach((day) => {
        const pendingCount = day.pendingCount ?? day.bookings.filter((booking) => booking.status === 'pending').length;
        const confirmedCount = day.bookings.filter((booking) => booking.status === 'confirmed' || booking.status === 'approved').length;
        fallbackDayDetails[day.iso] = {
          iso: day.iso,
          date: day.iso,
          dateLabel: dateFormatter.format(new Date(`${day.iso}T00:00:00`)),
          confirmedCount,
          pendingCount,
          remainingSlots: day.remainingSlots ?? 0,
          bookings: day.bookings,
          summary: day.bookings.length
            ? 'Review guest details, confirm approvals, or release slots as needed.'
            : day.isUnavailable
              ? 'House unavailable today for scheduled maintenance.'
              : 'Wide open day ready for a new booking.',
        };
      });
      fallbackResponse.selectedDay = fallbackDayDetails[fallbackResponse.calendar.selectedIso];

      const state = {
        response: null,
        selectedDay: null,
        dayCache: new Map(Object.entries(fallbackDayDetails).map(([date, detail]) => [date, JSON.parse(JSON.stringify(detail))])),
      };

      function clone(value) {
        return JSON.parse(JSON.stringify(value));
      }

      async function api(path, options) {
        if (!apiBase) {
          throw new Error('No API base configured.');
        }
        const response = await fetch(`${apiBase}${path}`, {
          headers: { 'Content-Type': 'application/json' },
          ...options,
        });
        if (!response.ok) {
          throw new Error(`Request failed with ${response.status}`);
        }
        return response.json();
      }

      function statusClassForDay(day) {
        if (day.isFull) return 'border-rose-200 bg-rose-50 text-rose-700';
        if ((day.pendingCount ?? 0) > 0) return 'border-amber-200 bg-amber-50';
        if (day.bookings.length > 0) return 'border-indigo-200 bg-indigo-50';
        if ((day.remainingSlots ?? 0) > 0) return 'border-emerald-200 bg-emerald-50';
        return 'border-slate-200 bg-white';
      }

      function renderSummary(response) {
        document.getElementById('resource-title').textContent = response.resource.displayName;
        document.getElementById('calendar-updated').textContent = response.calendar.updatedLabel ?? 'Updated just now';
        document.getElementById('calendar-next-open').textContent = response.calendar.nextAvailableLabel ?? 'Check the calendar';
        document.getElementById('metric-reservations').textContent = response.calendar.totalBookings ?? 0;
        document.getElementById('metric-pending').textContent = response.calendar.pendingCount ?? 0;
        document.getElementById('metric-remaining').textContent = response.calendar.remainingSlots ?? 0;
        document.getElementById('calendar-month-label').textContent = response.calendar.monthLabel;
        const newRequestLink = document.getElementById('new-request-link');
        if (newRequestLink) {
          const date = response.calendar.selectedIso ?? response.selectedDay?.iso ?? '';
          newRequestLink.href = `/bookings/new?resource_id=${response.resource.id}&date=${encodeURIComponent(date)}`;
        }
      }

      function renderCalendarGrid(calendar) {
        const container = document.getElementById('calendar-grid');
        if (!container) return;
        const labels = calendar.weekdayLabels.length > 0 ? calendar.weekdayLabels : ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
        const header = `<div class="grid grid-cols-7 gap-1 text-xs font-medium uppercase tracking-wide text-slate-500">${labels
          .map((label) => `<span class="px-2 py-1 text-center">${label}</span>`)
          .join('')}</div>`;
        const weeks = calendar.weeks
          .map((week) => {
            const days = week
              .map((day) => {
                const remaining = day.remainingSlots ?? 0;
                const pending = day.pendingCount ?? 0;
                const hasBookings = day.bookings.length > 0;
                const isSelected = calendar.selectedIso === day.iso;
                const disabled = Boolean(day.isUnavailable);
                const classes = [
                  'group flex h-28 flex-col justify-between rounded-lg border p-3 text-left text-sm shadow-sm transition hover:border-indigo-300 hover:shadow',
                  statusClassForDay(day),
                  day.isCurrentMonth === false ? 'opacity-60' : '',
                  isSelected ? 'ring-2 ring-indigo-500 border-indigo-500' : '',
                  disabled ? 'cursor-not-allowed opacity-60' : '',
                ]
                  .filter(Boolean)
                  .join(' ');
                const bookingsList = hasBookings
                  ? `<ul class="space-y-1">${day.bookings
                      .slice(0, 3)
                      .map(
                        (booking) => `<li class="flex items-center justify-between rounded-md bg-white/70 px-2 py-1 text-xs font-medium text-slate-600">
                          <span class="truncate">${booking.customerName}</span>
                          <span class="ml-2 shrink-0 text-[11px] text-slate-400">${booking.windowLabel}</span>
                        </li>`
                      )
                      .join('')}</ul>${day.bookings.length > 3 ? `<p class="text-[11px] text-slate-500">+${day.bookings.length - 3} more</p>` : ''}`
                  : '';
                let statusMessage = '<p class="rounded-md bg-slate-100 px-2 py-1 text-[11px] font-medium text-slate-600">Schedule opens soon</p>';
                if (remaining > 0) {
                  statusMessage = `<p class="rounded-md bg-emerald-50 px-2 py-1 text-[11px] font-semibold text-emerald-700">${remaining} slot${remaining === 1 ? '' : 's'} free</p>`;
                } else if (pending > 0) {
                  statusMessage = `<p class="rounded-md bg-amber-100 px-2 py-1 text-[11px] font-semibold text-amber-700">${pending} awaiting approval</p>`;
                } else if (day.isFull || hasBookings) {
                  statusMessage = '<p class="rounded-md bg-rose-100 px-2 py-1 text-[11px] font-semibold text-rose-700">Fully booked</p>';
                }
                return `<button type="button" class="${classes}" data-date="${day.iso}" ${disabled ? 'disabled' : ''} ${isSelected ? 'aria-current="date"' : ''}>
                  <div class="flex items-start justify-between gap-2">
                    <span class="text-base font-semibold">${day.dayLabel ?? day.dayNumber ?? day.iso.split('-').at(-1)}</span>
                    ${day.isToday ? '<span class="rounded-full bg-indigo-50 px-2 py-0.5 text-[11px] font-medium text-indigo-600">Today</span>' : ''}
                  </div>
                  <div class="space-y-1 text-xs">
                    ${bookingsList}
                    ${statusMessage}
                  </div>
                </button>`;
              })
              .join('');
            return `<div class="grid grid-cols-7 gap-1">${days}</div>`;
          })
          .join('');
        container.innerHTML = `${header}${weeks}`;
        container.querySelectorAll('button[data-date]').forEach((button) => {
          button.addEventListener('click', (event) => {
            const date = event.currentTarget.getAttribute('data-date');
            if (date) selectDay(date);
          });
        });
      }

      function renderDayOverview(day, resourceId) {
        const container = document.getElementById('day-overview');
        if (!container) return;
        if (!day) {
          container.innerHTML = '<p class="rounded-lg border border-dashed border-slate-200 bg-slate-50 p-6 text-center text-sm text-slate-500">Select a day in the calendar to view reservations and approve requests.</p>';
          return;
        }
        const alert = (day.remainingSlots ?? 0) === 0 && (day.pendingCount ?? 0) === 0
          ? '<div class="rounded-lg border border-rose-200 bg-rose-50 p-3 text-sm text-rose-700">All slots are filled. Decline or reschedule requests to reopen capacity.</div>'
          : (day.remainingSlots ?? 0) > 0
            ? `<div class="rounded-lg border border-emerald-200 bg-emerald-50 p-3 text-sm text-emerald-700">${day.remainingSlots} slot${day.remainingSlots === 1 ? '' : 's'} available. Send teammates a link to book.</div>`
            : '';
        const bookings = day.bookings.length > 0
          ? day.bookings
              .map((booking) => {
                const details = [booking.windowLabel];
                if (booking.partySize) details.push(`${booking.partySize} ppl`);
                if (booking.owner) details.push(`requested by ${booking.owner}`);
                const badgeClass = {
                  approved: 'bg-emerald-100 text-emerald-700',
                  confirmed: 'bg-emerald-100 text-emerald-700',
                  pending: 'bg-amber-100 text-amber-700',
                  declined: 'bg-rose-100 text-rose-700',
                  rejected: 'bg-rose-100 text-rose-700',
                }[booking.status] ?? 'bg-slate-100 text-slate-600';
                return `<li class="py-4">
                  <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                    <div class="min-w-0 space-y-1">
                      <p class="text-sm font-semibold text-slate-900">${booking.customerName}</p>
                      <p class="text-xs text-slate-500">${details.join(' · ')}</p>
                    </div>
                    <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold uppercase tracking-wide ${badgeClass}">${booking.status}</span>
                  </div>
                  ${booking.notes ? `<p class="mt-2 text-sm text-slate-500">${booking.notes}</p>` : ''}
                  <div class="mt-3 flex flex-wrap gap-2">
                    <a class="inline-flex items-center gap-2 rounded-md border border-slate-200 px-3 py-1 text-xs font-medium text-slate-600 transition hover:border-indigo-300 hover:text-indigo-600" href="/bookings/${booking.id}">View details</a>
                    ${booking.status === 'pending'
                      ? '<button class="inline-flex items-center gap-1 rounded-md bg-emerald-600 px-3 py-1 text-xs font-semibold text-white shadow-sm transition hover:bg-emerald-500" type="button">Approve</button><button class="inline-flex items-center gap-1 rounded-md bg-rose-600 px-3 py-1 text-xs font-semibold text-white shadow-sm transition hover:bg-rose-500" type="button">Decline</button>'
                      : ''}
                  </div>
                </li>`;
              })
              .join('')
          : '<li class="py-6 text-sm text-slate-500">No reservations yet. Use the button above to create one.</li>';
        container.innerHTML = `<div class="space-y-4">
          <div class="flex items-start justify-between gap-4">
            <div class="space-y-1">
              <h3 class="text-lg font-semibold text-slate-900">${day.dateLabel}</h3>
              <p class="text-sm text-slate-500">${day.summary ?? 'Manage requests, approvals, and open slots for this day.'}</p>
            </div>
            <a class="inline-flex items-center gap-2 rounded-md border border-slate-200 px-3 py-1.5 text-sm font-medium text-slate-600 transition hover:border-indigo-300 hover:text-indigo-600" href="/bookings/new?resource_id=${resourceId}&date=${day.iso}">Request slot</a>
          </div>
          <dl class="grid gap-3 sm:grid-cols-3">
            <div class="rounded-lg bg-slate-50 p-3"><dt class="text-xs font-medium uppercase tracking-wide text-slate-500">Confirmed</dt><dd class="mt-1 text-lg font-semibold text-indigo-600">${day.confirmedCount ?? 0}</dd></div>
            <div class="rounded-lg bg-slate-50 p-3"><dt class="text-xs font-medium uppercase tracking-wide text-slate-500">Pending</dt><dd class="mt-1 text-lg font-semibold text-amber-600">${day.pendingCount ?? 0}</dd></div>
            <div class="rounded-lg bg-slate-50 p-3"><dt class="text-xs font-medium uppercase tracking-wide text-slate-500">Slots free</dt><dd class="mt-1 text-lg font-semibold text-emerald-600">${day.remainingSlots ?? 0}</dd></div>
          </dl>
          ${alert}
          <ul class="divide-y divide-slate-100">${bookings}</ul>
        </div>`;
      }

      function renderPendingRequests(requests) {
        const container = document.getElementById('pending-approvals');
        const badge = document.getElementById('pending-count');
        if (!container || !badge) return;
        badge.textContent = `${requests.length} open`;
        if (requests.length === 0) {
          container.innerHTML = '<p class="py-6 text-sm text-slate-500">No pending approval requests.</p>';
          return;
        }
        const items = requests
          .map((request) => {
            const details = [request.dateLabel ?? request.date, request.windowLabel];
            if (request.partySize) details.push(`${request.partySize} ppl`);
            return `<li class="py-4">
              <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                <div class="min-w-0 space-y-1">
                  <p class="text-sm font-semibold text-slate-900">${request.customerName}</p>
                  <p class="text-xs text-slate-500">${details.join(' · ')}</p>
                </div>
                <span class="inline-flex items-center rounded-full bg-amber-100 px-2.5 py-1 text-xs font-semibold uppercase tracking-wide text-amber-700">Pending</span>
              </div>
              ${request.notes ? `<p class="mt-2 text-sm text-slate-500">${request.notes}</p>` : ''}
              <div class="mt-3 flex flex-wrap gap-2">
                <button class="inline-flex items-center gap-1 rounded-md bg-emerald-600 px-3 py-1 text-xs font-semibold text-white shadow-sm transition hover:bg-emerald-500" type="button">Approve</button>
                <button class="inline-flex items-center gap-1 rounded-md bg-rose-600 px-3 py-1 text-xs font-semibold text-white shadow-sm transition hover:bg-rose-500" type="button">Decline</button>
                <a class="inline-flex items-center gap-2 rounded-md border border-slate-200 px-3 py-1 text-xs font-medium text-slate-600 transition hover:border-indigo-300 hover:text-indigo-600" href="/bookings/${request.id}">View details</a>
              </div>
            </li>`;
          })
          .join('');
        container.innerHTML = `<ul class="divide-y divide-slate-100">${items}</ul>`;
      }
      async function selectDay(dateIso) {
        try {
          const detail = await api(`/calendar/day?date=${encodeURIComponent(dateIso)}`);
          state.dayCache.set(dateIso, detail);
        } catch (error) {
          if (!state.dayCache.has(dateIso)) {
            console.warn('Falling back to cached day detail for', dateIso, error);
            const fallbackDetail = fallbackDayDetails[dateIso];
            if (fallbackDetail) {
              state.dayCache.set(dateIso, clone(fallbackDetail));
            } else {
              return;
            }
          }
        }
        if (state.response?.calendar) {
          state.response.calendar.selectedIso = dateIso;
        }
        state.selectedDay = clone(state.dayCache.get(dateIso));
        renderDayOverview(state.selectedDay, state.response.resource.id);
        renderCalendarGrid(state.response.calendar);
      }

      async function loadCalendar() {
        try {
          const data = await api('/calendar');
          state.response = data;
          state.selectedDay = data.selectedDay ?? null;
        } catch (error) {
          console.warn('Using fallback calendar data because the API request failed.', error);
          state.response = clone(fallbackResponse);
          state.selectedDay = clone(fallbackResponse.selectedDay);
        }
        renderSummary(state.response);
        renderCalendarGrid(state.response.calendar);
        renderDayOverview(state.selectedDay, state.response.resource.id);
        renderPendingRequests(state.response.pendingRequests ?? []);
      }

      document.querySelectorAll('[data-calendar-action]').forEach((button) => {
        button.addEventListener('click', (event) => {
          const action = event.currentTarget.getAttribute('data-calendar-action');
          console.info(`Calendar action "${action}" clicked. Wire this to the API when endpoints are ready.`);
        });
      });

      document.addEventListener('DOMContentLoaded', () => {
        loadCalendar();
      });
    </script>
  </body>
</html>
